# Results


TODO 
time series + 改成柱状图& +growth rate 


```{r stations, include=FALSE}
library(tidyverse)
library(rvest)
library(robotstxt)
library(pander)
library(readxl)
#paths_allowed("https://data.ny.gov/api/views/7rrd-248n/rows.csv?accessType=DOWNLOAD&sorting=true")
stations <-read.csv("https://data.ny.gov/api/views/7rrd-248n/rows.csv?accessType=DOWNLOAD&sorting=true")
registration_url<-"https://www.nyserda.ny.gov/-/media/Files/Programs/ChargeNY/EV-Registration-Tables.xlsx"
temp <-tempfile(fileext = ".xlsx")
download.file(registration_url, destfile=temp, mode='wb')
registration_utility <- readxl::read_excel(temp, sheet =1)
registration_zipcode <- readxl::read_excel(temp, sheet =2)
registration_model <- readxl::read_excel(temp, sheet =3)
registration_county <- readxl::read_excel(temp, sheet =4)
registration_originaltime <- readxl::read_excel(temp, sheet =5)
registration_originalmake <- readxl::read_excel(temp, sheet =6)
```




<p style="font-size:23px;"> EV Charging Stations Info </p>
```{r}
## drop 3 columns with only NA values, will drop more irrelevant columns. Fuel Type Code has ELEV only. State has NY only. Status Code has E only
stations <- stations %>%
      select(- c("Plus4", "Expected.Date", "EV.Other.Info","Fuel.Type.Code","State","Station.Phone","Status.Code"))
```


Charging Stations Access Days Time
```{r}
stations$hours <- ifelse(grepl("24", stations$Access.Days.Time), "24hr", "other")
pie(table(stations$hours),col=grey.colors(2))
```
     
Charging Stations Owners
```{r}
ownerlist<-data.frame(table(stations$Owner.Type.Code[stations$Owner.Type.Code!=""]))
colnames(ownerlist)<-c("Owner_Type","Freq")
ownerlist$Owner_Type<-recode(ownerlist$Owner_Type,
  "FG" = "Federal government owned",
  "J" = "Jointly owned",
  "LG"="Local government owned",
  "P"="Privately owned",
  "SG"="State government owned",
  "T"="Utility owned"
)
ggplot(ownerlist, aes(x="", y=Freq, fill=Owner_Type)) +
 geom_bar(stat="identity", width=1) +
 coord_polar("y", start=0) +
  theme_void()
```

Charger types
```{r}
total_level2<-sum(na.omit(stations$EV.Level2.EVSE.Num))
total_level1<-sum(na.omit(stations$EV.Level1.EVSE.Num))
total_fast<-sum(na.omit(stations$EV.DC.Fast.Count))
tesla<-stations$EV.Connector.Types
tesla_count<-0
for (val in tesla)
{
    if(grepl(val,"TESLA")) tesla_count = tesla_count+1
}
chargertypedf <- data.frame(c("Level 1 - AC 110V","Level 2 - AC 240V", "DC Fast - DC Rapid Charging Others","DC Fast - Tesla"), c(total_level1,total_level2,total_fast-tesla_count,tesla_count))
colnames(chargertypedf)<-c("Connector_Type","Freq")
ggplot(chargertypedf, aes(x="", y=Freq, fill=Connector_Type)) +
 geom_bar(stat="identity", width=1) +
 coord_polar("y", start=0) +
  theme_void()
```

<p style="font-size:23px;"> EV Registration Info </p>
#Utility, original time and make may not be useful for our project.

Popular model ranking
```{r}
registration_modelname<-unite(registration_model, modelname, Make:Model, sep='-')[rev(order(registration_model$Registrations)),][-1,]
ggplot(registration_modelname, aes(x = reorder(`modelname`,-`Registrations`), y = `Registrations`)) +
  geom_col(position = "dodge")+theme(axis.text.x=element_text(angle=90, hjust=1))+labs(x="Make-Model")
```


County ranking
```{r}
sortedcounty<-registration_county[rev(order(registration_county$`Total EVs`)),][-1,]
ggplot(sortedcounty, aes(x = reorder(`County`,-`Total EVs`), y = `Total EVs`)) +
  geom_col(position = "dodge")+theme(axis.text.x=element_text(angle=90, hjust=1))+labs(x="County")
```

Zipcode heatmap of total EV stations
```{r}
library(choroplethrZip)
library(mapproj)

zip_group <- stations %>%
  group_by(ZIP)%>%
  summarize(Count=n())

colnames(zip_group) <- c("region", "value")
zip_group['region']=as.character(zip_group$region)

zip_choropleth(zip_group, 
               state_zoom = "new york", 
               title      = "Draw a heatmap for EV stations by zip",
               legend     = "Total EV stations") + coord_map()  

```

Zipcode heatmap of total EV Registrition
```{r}
totalcar_zip <- registration_zipcode%>%
      select(c("ZIP Code", "Total EVs"))

colnames(totalcar_zip) <- c("region", "value")

zip_choropleth(totalcar_zip, 
               state_zoom = "new york", 
               title      = "Draw a heatmap for EV registritions by zip",
               legend     = "Total EVs") + coord_map()  
```




```{r}
temp <- registration_originaltime[1:nrow(registration_originaltime)-1,]
temp  <- temp  %>%
  group_by(Year)%>%
  summarize(total_EV=sum(`Total EVs`))
ggplot(temp, aes(x=Year, y=total_EV))+geom_col()+ ggtitle('Number of Total EV by Years') + xlab("Year")+ylab("Number of Total EV")
```

<p style="font-size:23px;"> Time series </p>

```{r}
library(lubridate)
stations_ts <- stations
stations_ts$Open.Date <- as.Date(stations_ts$Open.Date, "%m/%d/%Y")

#stations_ts["Open.year"] <- year(stations_ts$Open.Date)
#stations_ts["Open.month"] <- month(stations_ts$Open.Date)

num <- data.frame(table(factor(format(stations_ts$Open.Date,"%D"))))
num$Date <- as.Date(num$Var1,"%m/%d/%y")
ggplot(num, aes(Date, Freq))+geom_line()+ ggtitle('Time Series Analysis on the Number of Newly Opened stations') + xlab("Date")+ylab("Number of Stations Count")
```

The above graph plots the number of newly opened stations on a certain day. It is clear that there are more stations opened in recent years. 





